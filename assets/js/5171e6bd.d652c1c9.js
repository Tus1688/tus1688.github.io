"use strict";(self.webpackChunktus_1688_github_io=self.webpackChunktus_1688_github_io||[]).push([[7874],{2004:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>d,frontMatter:()=>l,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"Project/Openmerce/index","title":"Openmerce","description":"Openmerce is a wonderful e-commerce platform that is built with SvelteKit as the","source":"@site/docs/Project/Openmerce/index.md","sourceDirName":"Project/Openmerce","slug":"/Project/Openmerce/","permalink":"/docs/Project/Openmerce/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Kali Docker on VNC","permalink":"/docs/Project/Kali Docker on VNC/"},"next":{"title":"Internal CRM","permalink":"/docs/Project/Internal CRM/"}}');var r=t(4848),s=t(8453);const l={sidebar_position:3},o="Openmerce",a={},h=[{value:"Analysis phase",id:"analysis-phase",level:3},{value:"Reason for choosing those tech stack",id:"reason-for-choosing-those-tech-stack",level:3},{value:"What I learned",id:"what-i-learned",level:3},{value:"What I would do differently",id:"what-i-would-do-differently",level:3},{value:"Misc.",id:"misc",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"openmerce",children:"Openmerce"})}),"\n",(0,r.jsx)(n.p,{children:"Openmerce is a wonderful e-commerce platform that is built with SvelteKit as the\nfrontend and Gin-Gonic as the backend. We built this project to learn more about\nmicroservices architecture and how to build a scalable e-commerce platform that\nhas a great CI/CD pipeline for development and production."}),"\n",(0,r.jsxs)(n.admonition,{type:"note",children:[(0,r.jsx)(n.p,{children:"Because we use microservices architecture, there are many repos that we need such as:"}),(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Frontend for the user ",(0,r.jsx)(n.a,{href:"https://github.com/CologneX/OpenMerce-SvelteKit",children:"link to repo"})]}),"\n",(0,r.jsxs)(n.li,{children:["Frontend for the staff ",(0,r.jsx)(n.a,{href:"https://github.com/CologneX/openmerce-staff-sveltekit",children:"link to repo"})]}),"\n",(0,r.jsxs)(n.li,{children:["Backend for the user & staff ",(0,r.jsx)(n.a,{href:"https://github.com/Tus1688/openmerce-backend",children:"link to repo"})]}),"\n",(0,r.jsxs)(n.li,{children:["Image server ",(0,r.jsx)(n.a,{href:"https://github.com/Tus1688/go-nginx-fs",children:"link to repo"})]}),"\n",(0,r.jsx)(n.li,{children:"Freight cost service (sorry this is still private)"}),"\n",(0,r.jsxs)(n.li,{children:["Deployment (Docker Swarm) ",(0,r.jsx)(n.a,{href:"https://github.com/Tus1688/openmerce-deployment",children:"link to repo"})]}),"\n"]})]}),"\n",(0,r.jsx)(n.h3,{id:"analysis-phase",children:"Analysis phase"}),"\n",(0,r.jsx)(n.p,{children:"At the beginning of the project, we were confused as hell on what frontend to use,\nwhat backend to use, and how to integrate them together. But instead of just\nthinking and wondering, we decided to just start designing the database and the\ninfra. This attitude is very important because we can't just think and think. Time\nis money, and I am thankful that I really accostumed to this attitude."}),"\n",(0,r.jsxs)(t,{children:[(0,r.jsx)("summary",{children:"Features"}),(0,r.jsx)("p",{children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Customer Authentication","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Email Verification"}),"\n",(0,r.jsx)(n.li,{children:"Login / Register"}),"\n",(0,r.jsx)(n.li,{children:"Reset Password"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Customer Page","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Profile"}),"\n",(0,r.jsx)(n.li,{children:"Order History"}),"\n",(0,r.jsx)(n.li,{children:"Wishlist"}),"\n",(0,r.jsx)(n.li,{children:"Cart"}),"\n",(0,r.jsx)(n.li,{children:"Checkout"}),"\n",(0,r.jsx)(n.li,{children:"Payment (from midtrans)"}),"\n",(0,r.jsx)(n.li,{children:"Shipping Address"}),"\n",(0,r.jsx)(n.li,{children:"Review"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Staff Authentication","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Login"}),"\n",(0,r.jsx)(n.li,{children:"Create new staff"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Staff Page","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Create, Update, Delete Product"}),"\n",(0,r.jsx)(n.li,{children:"Create, Update, Delete Category"}),"\n",(0,r.jsx)(n.li,{children:"List Order"}),"\n",(0,r.jsx)(n.li,{children:"Update Order Status"}),"\n"]}),"\n"]}),"\n"]})})]}),"\n",(0,r.jsxs)(t,{children:[(0,r.jsx)("summary",{children:"Technical Features"}),(0,r.jsx)("p",{children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Our Infrastructure","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Docker Swarm as the orchestrator"}),"\n",(0,r.jsx)(n.li,{children:"Traefik as the reverse proxy"}),"\n",(0,r.jsx)(n.li,{children:"1 Azure VM for the manager node and 2 VM from Azure & my university for the worker node"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Database","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"MySQL as the main database"}),"\n",(0,r.jsx)(n.li,{children:"Redis as the cache"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Backend","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Gin-Gonic as it has a great performance in terms of development speed/productivity and performance"}),"\n",(0,r.jsx)(n.li,{children:"No ORM, we use raw SQL because we want to have a granular control over the database and query optimization"}),"\n",(0,r.jsxs)(n.li,{children:["There are 3 services:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Main (business logic)"}),"\n",(0,r.jsx)(n.li,{children:"Image Optimization (convert the image into webp and serve it through nginx, we incorporate this service with\nfiber)"}),"\n",(0,r.jsx)(n.li,{children:"Freight Cost (calculate the freight cost based on the weight and the destination)"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Frontend","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"SvelteKit because that's what my partner familliar with and has a great performance also the most important thing\nis that it is very easy to differentiate the page with the server side and the client side rendering"}),"\n",(0,r.jsx)(n.li,{children:"We created 2 project with SvelteKit, one for the user and one for the staff. Because it is easier for us to set\nthe virtual host in Traefik"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Authentication","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"We use JWT for authentication"}),"\n",(0,r.jsx)(n.li,{children:"For the refresh token, it has similar functionality with my previous project (Mini ERP), but I enhanced it a little\nbit by changing the value of the refresh token everytime the user request a new access token"}),"\n",(0,r.jsx)(n.li,{children:"Every cookie put in the browser is httpOnly and sameSite=strict, so I don't see the point of using CSRF token"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["CI/CD","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"We use Github Actions to build and push the image to the registry (github package)"}),"\n",(0,r.jsx)(n.li,{children:"We created shell script in the manager node. I also created non privileges user that only has sudo privilege to run that shell script. The\nshell script will pull the image from the registry and deploy it to the swarm every time there is a new image\npushed to the registry (I am confident that this way there won't be any kind of privilege escalation nor security hole)"}),"\n",(0,r.jsx)(n.li,{children:"There would be a little bit downtime because we didn't use healthcheck in all of our services. I will fix this in the future"}),"\n"]}),"\n"]}),"\n"]})})]}),"\n",(0,r.jsx)(n.h3,{id:"reason-for-choosing-those-tech-stack",children:"Reason for choosing those tech stack"}),"\n",(0,r.jsx)(n.p,{children:"Security is the most important thing in every aspect of my life. So I always\nmake sure that I use the best and well known library/framework. Also, compatibility\nand performance are also important. Nevertheless, We won't use something that\nwe don't understand."}),"\n",(0,r.jsx)(n.h3,{id:"what-i-learned",children:"What I learned"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Multiple node deployment"}),"\n",(0,r.jsx)(n.li,{children:"Save a lot of time using CI/CD"}),"\n",(0,r.jsx)(n.li,{children:"How to use Docker Swarm"}),"\n",(0,r.jsx)(n.li,{children:"Better and more secure authentication"}),"\n",(0,r.jsx)(n.li,{children:"Better concurrency control"}),"\n",(0,r.jsx)(n.li,{children:"Multiple integration with third party service"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"what-i-would-do-differently",children:"What I would do differently"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use Kubernetes instead of Docker Swarm"}),"\n",(0,r.jsx)(n.li,{children:"Add healthcheck to all of the services"}),"\n",(0,r.jsx)(n.li,{children:'Use a "better" CI/CD tool such as Gitlab CI'}),"\n",(0,r.jsx)(n.li,{children:"Distribute the redis cache to all of the worker node instead of just one node"}),"\n",(0,r.jsx)(n.li,{children:"Utilize the backend of SvelteKit more"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"misc",children:"Misc."}),"\n",(0,r.jsx)(n.p,{children:"Example of the shell script in the manager node"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"#!/bin/bash\n\ndocker pull ghcr.io/tus1688/openmerce-backend:main\ndocker service update --image ghcr.io/tus1688/openmerce-backend:main <the service name>\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Put it as let's say ",(0,r.jsx)(n.code,{children:"backend.sh"})," in the non-privileges user home directory. Remember,\ndon't forget to ",(0,r.jsx)(n.code,{children:"chmod +x backend.sh"})," and make sure that the non-privileges user\ndoesn't have any sudo privilege except for running this script. Oh 1 more thing,\nremove the write privilege from the script so that the non-privileges user can't\nmodify the script."]}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsxs)(n.p,{children:["Never ever use suid bit in the script. It is very dangerous!\n",(0,r.jsx)(n.code,{children:"sudo"})," is the way to go. ",(0,r.jsx)(n.a,{href:"https://superuser.com/a/232258",children:"reference"})]})}),"\n",(0,r.jsx)(n.p,{children:"Remember, always consult with your team and official documentation before creating\nsomething. Don't be afraid to ask, because that's the only way to learn."})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>o});var i=t(6540);const r={},s=i.createContext(r);function l(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);