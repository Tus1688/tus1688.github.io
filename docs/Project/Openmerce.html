<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Project/Openmerce/index">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Openmerce | Tus1688</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://tus1688.github.io/docs/Project/Openmerce"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Openmerce | Tus1688"><meta data-rh="true" name="description" content="Openmerce is a wonderful e-commerce platform that is built with SvelteKit as the"><meta data-rh="true" property="og:description" content="Openmerce is a wonderful e-commerce platform that is built with SvelteKit as the"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://tus1688.github.io/docs/Project/Openmerce"><link data-rh="true" rel="alternate" href="https://tus1688.github.io/docs/Project/Openmerce" hreflang="en"><link data-rh="true" rel="alternate" href="https://tus1688.github.io/docs/Project/Openmerce" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Tus1688 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Tus1688 Atom Feed"><link rel="stylesheet" href="/assets/css/styles.c997b2e2.css">
<link rel="preload" href="/assets/js/runtime~main.be09f879.js" as="script">
<link rel="preload" href="/assets/js/main.167a370a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.webp" alt="Tus1688 Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="Tus1688 Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Tus1688</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">My works</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/tus1688" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/Project">Project</a><button aria-label="Toggle the collapsible sidebar category &#x27;Project&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Project/Mini ERP">Mini ERP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Project/Kali Docker on VNC">Kali Docker on VNC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Project/Openmerce">Openmerce</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Web Development/React Nginx Config">Web Development</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/Project"><span itemprop="name">Project</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Openmerce</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Openmerce</h1><p>Openmerce is a wonderful e-commerce platform that is built with SvelteKit as the
frontend and Gin-Gonic as the backend. We built this project to learn more about
microservices architecture and how to build a scalable e-commerce platform that
has a great CI/CD pipeline for development and production.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Because we use microservices architecture, there are many repos that we need such as:</p><ol><li>Frontend for the user <a href="https://github.com/CologneX/OpenMerce-SvelteKit" target="_blank" rel="noopener noreferrer">link to repo</a></li><li>Frontend for the staff <a href="https://github.com/CologneX/openmerce-staff-sveltekit" target="_blank" rel="noopener noreferrer">link to repo</a></li><li>Backend for the user &amp; staff <a href="https://github.com/Tus1688/openmerce-backend" target="_blank" rel="noopener noreferrer">link to repo</a></li><li>Image server <a href="https://github.com/Tus1688/go-nginx-fs" target="_blank" rel="noopener noreferrer">link to repo</a></li><li>Freight cost service (sorry this is still private)</li><li>Deployment (Docker Swarm) <a href="https://github.com/Tus1688/openmerce-deployment" target="_blank" rel="noopener noreferrer">link to repo</a></li></ol></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="analysis-phase">Analysis phase<a href="#analysis-phase" class="hash-link" aria-label="Direct link to Analysis phase" title="Direct link to Analysis phase">​</a></h3><p>At the beginning of the project, we were confused as hell on what frontend to use,
what backend to use, and how to integrate them together. But instead of just
thinking and wondering, we decided to just start designing the database and the
infra. This attitude is very important because we can&#x27;t just think and think. Time
is money, and I am thankful that I really accostumed to this attitude.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Features</summary><div><div class="collapsibleContent_i85q"><p></p><ul><li>Customer Authentication<ul><li>Email Verification</li><li>Login / Register</li><li>Reset Password</li></ul></li><li>Customer Page<ul><li>Profile</li><li>Order History</li><li>Wishlist</li><li>Cart</li><li>Checkout</li><li>Payment (from midtrans)</li><li>Shipping Address</li><li>Review</li></ul></li><li>Staff Authentication<ul><li>Login</li><li>Create new staff</li></ul></li><li>Staff Page<ul><li>Create, Update, Delete Product</li><li>Create, Update, Delete Category</li><li>List Order</li><li>Update Order Status</li></ul></li></ul><p></p></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Technical Features</summary><div><div class="collapsibleContent_i85q"><p></p><ul><li>Our Infrastructure<ul><li>Docker Swarm as the orchestrator</li><li>Traefik as the reverse proxy</li><li>1 Azure VM for the manager node and 2 VM from Azure &amp; my university for the worker node</li></ul></li><li>Database<ul><li>MySQL as the main database</li><li>Redis as the cache</li></ul></li><li>Backend<ul><li>Gin-Gonic as it has a great performance in terms of development speed/productivity and performance</li><li>No ORM, we use raw SQL because we want to have a granular control over the database and query optimization</li><li>There are 3 services:<ul><li>Main (business logic)</li><li>Image Optimization (convert the image into webp and serve it through nginx, we incorporate this service with
fiber)</li><li>Freight Cost (calculate the freight cost based on the weight and the destination)</li></ul></li></ul></li><li>Frontend<ul><li>SvelteKit because that&#x27;s what my partner familliar with and has a great performance also the most important thing
is that it is very easy to differentiate the page with the server side and the client side rendering</li><li>We created 2 project with SvelteKit, one for the user and one for the staff. Because it is easier for us to set
the virtual host in Traefik</li></ul></li><li>Authentication<ul><li>We use JWT for authentication</li><li>For the refresh token, it has similar functionality with my previous project (Mini ERP), but I enhanced it a little
bit by changing the value of the refresh token everytime the user request a new access token</li><li>Every cookie put in the browser is httpOnly and sameSite=strict, so I don&#x27;t see the point of using CSRF token</li></ul></li><li>CI/CD<ul><li>We use Github Actions to build and push the image to the registry (github package)</li><li>We created shell script in the manager node. I also created non privileges user that only has sudo privilege to run that shell script. The
shell script will pull the image from the registry and deploy it to the swarm every time there is a new image
pushed to the registry (I am confident that this way there won&#x27;t be any kind of privilege escalation nor security hole)</li><li>There would be a little bit downtime because we didn&#x27;t use healthcheck in all of our services. I will fix this in the future</li></ul></li></ul><p></p></div></div></details><h3 class="anchor anchorWithStickyNavbar_LWe7" id="reason-for-choosing-those-tech-stack">Reason for choosing those tech stack<a href="#reason-for-choosing-those-tech-stack" class="hash-link" aria-label="Direct link to Reason for choosing those tech stack" title="Direct link to Reason for choosing those tech stack">​</a></h3><p>Security is the most important thing in every aspect of my life. So I always
make sure that I use the best and well known library/framework. Also, compatibility
and performance are also important. Nevertheless, We won&#x27;t use something that
we don&#x27;t understand.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-i-learned">What I learned<a href="#what-i-learned" class="hash-link" aria-label="Direct link to What I learned" title="Direct link to What I learned">​</a></h3><ul><li>Multiple node deployment</li><li>Save a lot of time using CI/CD</li><li>How to use Docker Swarm</li><li>Better and more secure authentication</li><li>Better concurrency control</li><li>Multiple integration with third party service</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-i-would-do-differently">What I would do differently<a href="#what-i-would-do-differently" class="hash-link" aria-label="Direct link to What I would do differently" title="Direct link to What I would do differently">​</a></h3><ul><li>Use Kubernetes instead of Docker Swarm</li><li>Add healthcheck to all of the services</li><li>Use a &quot;better&quot; CI/CD tool such as Gitlab CI</li><li>Distribute the redis cache to all of the worker node instead of just one node</li><li>Utilize the backend of SvelteKit more</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="misc">Misc.<a href="#misc" class="hash-link" aria-label="Direct link to Misc." title="Direct link to Misc.">​</a></h3><p>Example of the shell script in the manager node</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> pull ghcr.io/tus1688/openmerce-backend:main</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">service</span><span class="token plain"> update --image ghcr.io/tus1688/openmerce-backend:main </span><span class="token operator">&lt;</span><span class="token plain">the </span><span class="token function" style="color:rgb(80, 250, 123)">service</span><span class="token plain"> name</span><span class="token operator">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Put it as let&#x27;s say <code>backend.sh</code> in the non-privileges user home directory. Remember,
don&#x27;t forget to <code>chmod +x backend.sh</code> and make sure that the non-privileges user
doesn&#x27;t have any sudo privilege except for running this script. Oh 1 more thing,
remove the write privilege from the script so that the non-privileges user can&#x27;t
modify the script.</p><div class="theme-admonition theme-admonition-warning alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_S0QG"><p>Never ever use suid bit in the script. It is very dangerous!
<code>sudo</code> is the way to go. <a href="https://superuser.com/a/232258" target="_blank" rel="noopener noreferrer">reference</a></p></div></div><p>Remember, always consult with your team and official documentation before creating
something. Don&#x27;t be afraid to ask, because that&#x27;s the only way to learn.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Project/Kali Docker on VNC"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Kali Docker on VNC</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Web Development/React Nginx Config"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">React Nginx Config</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#analysis-phase" class="table-of-contents__link toc-highlight">Analysis phase</a></li><li><a href="#reason-for-choosing-those-tech-stack" class="table-of-contents__link toc-highlight">Reason for choosing those tech stack</a></li><li><a href="#what-i-learned" class="table-of-contents__link toc-highlight">What I learned</a></li><li><a href="#what-i-would-do-differently" class="table-of-contents__link toc-highlight">What I would do differently</a></li><li><a href="#misc" class="table-of-contents__link toc-highlight">Misc.</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Tus1688</div></div></div></footer></div>
<script src="/assets/js/runtime~main.be09f879.js"></script>
<script src="/assets/js/main.167a370a.js"></script>
</body>
</html>